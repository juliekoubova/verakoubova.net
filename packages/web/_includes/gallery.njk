{% from 'macros.njk' import image %}

<nav class="fixed bottom-0 left-0 right-0" data-controller="active-dot">
  <ol class="flex flex-wrap justify-center mb-8 mx-2 relative">
  {% for img in gallery.images %}
  <li>
    <a
      href="#{{ img | lang | slug if not loop.first }}"
      title="{{ img | lang }}"
      class="block py-2 opacity-0 transition-opacity duration-700 ease-out"
      data-target="active-dot.link"
      >
      <svg viewBox="0 0 20 10" width="4" height="2" class="w-4 h-2 text-gray-600 pointer-events-none">
        <circle cx="10" cy="5" r="4" fill="currentColor" />
      </svg>
      <span class="sr-only">{{ img | lang }}</span>
    </a>
  </li>
  {% endfor %}
  </ol>
</nav>

<ol>
{% for img in gallery.images %}
  {% set left = img.left | lang | item(gallery.imageBase) %}
  {% set right = img.right | lang | item(gallery.imageBase) %}

  {% if left and right %}
    {% set flexBasis = " sm:w-1/3" %}
  {% elif left or right %}
    {% set flexBasis = " sm:w-1/2" %}
  {% else %}
    {% set flexBasis = "" %}
  {% endif %}

  {% set leftClass = left.data.class | lang %}
  {% set rightClass = right.data.class | lang %}

  {% set objectAlign = 'sm:object-top' %}
  {% set objectAlign = 'sm:object-left-top' if left %}
  {% set objectAlign = 'sm:object-right-top' if right %}

  {% set blockClass = 'snap-start sm:snap-none pt-20 pb-12 sm:pt-0 sm:pb-0 h-screen sm:h-auto' + flexBasis %}

  {% set leftHtml = (left.templateContent if left) | trim %}
  {% set rightHtml = (right.templateContent if right) | trim %}

  <li
    class="sm:h-screen sm:py-32 sm:flex items-center sm:snap-start"
    data-title="{{ img | lang }}"
    {% if loop.first %}
    data-navigation-top
    {% else %}
    id="{{ img | lang | slug }}"
    {% endif %}
    >
    <h3 class="sr-only">{{ item | lang }}</h3>

    <div class="sm:max-h-full sm:flex sm:max-w-2xl lg:max-w-4xl mx-auto">
      {% if left %}
      <div class="{{ blockClass }} {{ leftClass }}">
        {{ leftHtml | safe }}
      </div>
      {% endif %}

      <div
        class="sm:mx-4 {{ blockClass }} flex-1"

        {% if loop.first %}
        data-target="snap-type.determineBy"
        {% endif %}
      >
        {{ image(
                img,
                gallery.imageBase | ensureTrailingSlash,
                class='object-scale-down h-full w-full ' + objectAlign
          ) }}
      </div>

      {% if right %}
      <div class="{{ blockClass }} {{ rightClass }}">
        {{ rightHtml | safe }}
      </div>
      {% endif %}
    </div>

  </li>
{% endfor %}
</ol>